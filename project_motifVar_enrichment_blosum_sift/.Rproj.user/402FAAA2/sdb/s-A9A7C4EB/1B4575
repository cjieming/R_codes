{
    "contents" : "# setwd('C:/Users/Jieming/Documents/thesis/lynne_work/motifVar/tpr')\n# setwd('C:/Users/Jieming/Documents/thesis/lynne_work/motifVar/tpr/split into 2')\n# setwd('C:/Users/Jieming/Documents/thesis/lynne_work/motifVar/tpr/3tpr')\n# setwd('C:/Users/Jieming/Documents/thesis/lynne_work/motifVar/tpr/exac')\n# setwd('C:/Users/Jieming/Documents/thesis/lynne_work/motifVar/tpr/single proteins/TTC21B')\nsetwd('C:/Users/Jieming/Documents/thesis/lynne_work/motifVar/tpr/1kg.esp6500')\n\ndomain = '1KG TPR'\n\n## data\n# data = read.table('final.merged.ExAC.ens73.TPR.34aa.vepoutput.coding.canonical.sorted.auto.enrich', sep=\"\\t\", header=T, stringsAsFactors = F)\n# data = read.table('final.merged.ExAC.ens73.TPR.34aa.vepoutput.coding.canonical.sorted.auto.571.uniqseq.1tpr.AC.enrich', sep=\"\\t\", header=T, stringsAsFactors = F)\n# data = read.table('final.merged.ExAC.ens73.TPR.34aa.vepoutput.coding.canonical.sorted.auto.571.uniqseq.1tpr.FLY.enrich', sep=\"\\t\", header=T, stringsAsFactors = F)\ndata = read.table('1KG.snps.nonmono.smartDomain2gPos.TPR.34aa.noS.enrich', sep=\"\\t\", header=T, stringsAsFactors = F)\ndata[data==0.001] <- 0\ndata.mnoS = matrix(nrow = nrow(data), ncol = 2)\ndata.mS = matrix(nrow = nrow(data), ncol = 2)\norder = read.table('order_relentropy-tpr.txt', header=T, stringsAsFactors = F, comment.char=\"\", sep=\"\\t\")\ndata$V20 = factor(data$resNum, levels=levels(data$resNum)<-order$pos)\n\n## fisher's test\n## pval and foldchange in data.m\n## S and noS are with singletons (AC=1) and without singletons\n## each row in the matrix is the position\nfor(i in 1:nrow(data))\n{\n  d.noS <- matrix(c(data$numRareNS.noS[i],data$numCommNS.noS[i],data$numRareS.noS[i],\n                          data$numCommS.noS[i]), 2,2, \n                   dimnames = list(Pathways = c(\"rare\",\"comm\"),SNPs = c(\"NS\",\"S\")))  \n  \n  d.S <- matrix(c(data$numRareNS[i],data$numCommNS[i],data$numRareS[i],\n                data$numCommS[i]), 2,2, \n              dimnames = list(Pathways = c(\"rare\",\"comm\"),SNPs = c(\"NS\",\"S\")))  \n  \n  x.noS = fisher.test(d.noS,alternative=\"two.sided\")\n  x.S = fisher.test(d.S,alternative=\"two.sided\")\n  \n  data.mnoS[i,1] = x.noS$p.value\n  data.mnoS[i,2] = x.noS$estimate\n  \n  data.mS[i,1] = x.S$p.value\n  data.mS[i,2] = x.S$estimate\n}\n\n\n############################################ plot bar plots\n###### rare.ns vs comm.ns\n#### noS\nrare.comm.ns.noS = data$numRareNS.noS + data$numCommNS.noS\nyuplimit = max(rare.comm.ns.noS)+5\nx11()\npar(cex.axis=1, cex.lab=2, cex.main=2)\n# barplot(rare.comm.ns,names.arg=data$resNum,main=paste('variants by ', domain, ' motif pos'),col='blue')\n# barplot(data$numRareNS.noS,add=T,xaxt=\"n\",col='red') # tab.var.noSingle\nbarplot(rare.comm.ns.noS,names.arg=data$resNum,main=paste('variants by ', domain, ' motif pos'),\n        col='blue', ylim=c(0,yuplimit))\nbarplot(data$numRareNS.noS,add=T,xaxt=\"n\",col='red',ylim=c(0,yuplimit)) # tab.var.noSingle\n\nlegend(3,yuplimit,c(\"rare.ns.noS\",\"comm.ns.noS\"),\n       col=c(\"red\",\"blue\"), cex=2, pt.cex=2,\n       text.col = \"black\", pch = 15, bg = 'white')\n\n#### S\n# rare.comm.ns = data$numRareNS + data$numCommNS\n# yuplimit = 250\n# x11()\n# par(cex.axis=1, cex.lab=2, cex.main=2)\n# barplot(rare.comm.ns,names.arg=data$resNum,main=paste('variants by ', domain, ' motif pos'),\n#         col='blue', ylim=c(0,yuplimit))\n# barplot(data$numRareNS,add=T,xaxt=\"n\",col='red',ylim=c(0,yuplimit)) # tab.var\n# \n# legend(3,yuplimit,c(\"rare.ns\",\"comm.ns\"),\n#        col=c(\"red\",\"blue\"), cex=2, pt.cex=2,\n#        text.col = \"black\", pch = 15, bg = 'white')\n\n\n############################################ \n###### rare.s vs comm.s\n#### noS\nrare.comm.s.noS = data$numRareS.noS + data$numCommS.noS\nyuplimit = max(rare.comm.s.noS)+5\nx11()\npar(cex.axis=1, cex.lab=2, cex.main=2)\nbarplot(rare.comm.s.noS,names.arg=data$resNum,main=paste('variants by ',domain,' motif pos'),\n        col='cyan',ylim=c(0,yuplimit))\nbarplot(data$numRareS.noS,add=T,xaxt=\"n\",col='magenta',ylim=c(0,yuplimit)) # tab.var.noSingle\n\n\nlegend(3,yuplimit,c(\"rare.s.noS\",\"comm.s.noS\"),\n       col=c(\"magenta\",\"cyan\"), cex=2, pt.cex=2,\n       text.col = \"black\", pch = 15, bg = 'white')\n\n#### S\n# rare.comm.s = data$numRareS + data$numCommS\n# yuplimit = 150\n# x11()\n# par(cex.axis=1, cex.lab=2, cex.main=2)\n# barplot(rare.comm.s,names.arg=data$resNum,main=paste('variants by ',domain,' motif pos'),\n#         col='cyan',ylim=c(0,yuplimit))\n# barplot(data$numRareS,add=T,xaxt=\"n\",col='magenta',ylim=c(0,yuplimit)) # tab.var\n# \n# legend(3,yuplimit,c(\"rare.s\",\"comm.s\"),\n#        col=c(\"magenta\",\"cyan\"), cex=2, pt.cex=2,\n#        text.col = \"black\", pch = 15, bg = 'white')\n\n#############################################################\n### common v rare\n## noS\nnum.Comm.noS = data$totVar.noS  - data$numRare.noS\na = log(data$numRare.noS/num.Comm.noS)\na.finite = a[!is.infinite(a)]\na[a == \"Inf\"] <- max(a.finite) +1\na[a == \"-Inf\"] <- -max(a.finite) -1\nx11()\nbarplot(a,names.arg=data$resNum,\n        main=paste('rare:common variants noS by ',domain,'motif pos'), \n        col='red')\n\n## S\n# x11()\n# num.Comm = data$totVar  - data$numRare\n# a = log(data$numRare/num.Comm)\n# a[a == \"Inf\"] <- 2.5\n# a[a == \"-Inf\"] <- -2.5\n# barplot(a,names.arg=data$resNum,\n#         main=paste('rare:common variants by ',domain,'motif pos'), \n#         col='red')\n\n#############################################################\n### ratio of ns-s\n## noS\nnum.S.noS = data$numRareS.noS + data$numCommS.noS\nx11()\npar(cex.axis=1, cex.lab=2, cex.main=2)\nb=log(data$num.NS.noS/num.S.noS)\nb.finite = b[!is.infinite(a)]\nb[b == \"Inf\"] <- max(a.finite) +1\nb[b == \"-Inf\"] <- -max(a.finite) -1\nbarplot(b, names.arg=data$resNum,\n        main=paste('ns:s variants noS by ',domain,'motif pos'), \n        col='orange')\n\n# ordered\ndata.ordered = data[order(data$V20),]\nnum.S.noS.ordered = data.ordered$numRareS.noS + data.ordered$numCommS.noS\nx11()\nb1=log(data.ordered$num.NS.noS/num.S.noS.ordered)\nb1.finite = b1[!is.infinite(b1)]\nb1[b1 == \"Inf\"] <- max(b1.finite) +1\nb1[b1 == \"-Inf\"] <- -max(b1.finite) -1\nbarplot(b1, names.arg=data.ordered$resNum,\n        main=paste('ns:s variants noS by ',domain,'motif pos'), \n        col='orange')\n\n## S\n# num.S = data$numRareS + data$numCommS\n# x11()\n# par(cex.axis=1, cex.lab=2, cex.main=2)\n# b=log(data$num.NS/num.S)\n# b[b == \"-Inf\"] <- -2.5\n# b[b == \"Inf\"] <- 2.5\n# barplot(b, names.arg=data$resNum,\n#         main=paste('ns:s variants by ',domain,'motif pos'), \n#         col='orange')\n\n#############################################################\n### ratio of ns.rare v s.rare\n## noS\nx11()\npar(cex.axis=1, cex.lab=2, cex.main=2)\nc=log(data$numRareNS.noS/data$numRareS.noS)\nc.finite = c[!is.infinite(c)]\nc[c == \"Inf\"] <- max(c.finite) +1\nc[c == \"-Inf\"] <- -max(c.finite) -1\nbarplot(c, names.arg=data$resNum,\n        main=paste('ns.rare:s.rare variants noS by ',domain,'motif pos'), \n        col='red')\n\n## S\n# x11()\n# par(cex.axis=1, cex.lab=2, cex.main=2)\n# c=log(data$numRareNS/data$numRareS)\n# c[c == \"-Inf\"] <- -2.5\n# c[c == \"Inf\"] <- 2.5\n# barplot(c, names.arg=data$resNum,\n#         main=paste('ns.rare:s.rare variants by ',domain,'motif pos'), \n#         col='red')\n\n#############################################################\n### ratio of ns.comm v s.comm\n## noS\nx11()\npar(cex.axis=1, cex.lab=2, cex.main=2)\nd=log(data$numCommNS.noS/data$numCommS.noS)\nd.finite = d[!is.infinite(d)]\nd[d == \"Inf\"] <- max(d.finite) +1\nd[d == \"-Inf\"] <- -max(d.finite) -1\n# d[d == \"NaN\"] <- 0\nbarplot(d, names.arg=data$resNum,\n        main=paste('ns.comm:s.comm variants noS by ',domain,'motif pos'), \n        col='black')\n\n#############################################################\n#### combining ns.rarecomm:s.rarecomm\n### noS\nx11()\nbarplot(rbind(c,d), names.arg=data$resNum,\n        main=paste('ns.rarecomm:s.rarecomm variants noS by ',domain,'motif pos'), \n        col=c('red','blue'),beside=TRUE)\n\nlegend(25,2.5,c(\"nsrare:srare\",\"nscomm:scomm\"),c('red','blue'))\n\n\n#############################################################\n#### nsrare:nscommon\n### noS\nx11()\npar(cex.axis=1, cex.lab=2, cex.main=2)\nz=log(data$numRareNS.noS/data$numCommNS.noS)\nz.finite = z[!is.infinite(z)]\nz[z == \"Inf\"] <- max(z.finite) +1\nz[z == \"-Inf\"] <- -max(z.finite) -1\nyuplimit = max(z.finite)+1\nbarplot(z, names.arg=data$resNum,ylim=c(0,yuplimit),\n        main=paste('ns.rare:ns.comm variants noS by ',domain,'motif pos'), \n        col='purple')\n\n#############################################################\n#### odds ratio = nsrare:nscommon/srare:scommon\n### noS\nx11()\npar(cex.axis=1, cex.lab=2, cex.main=2)\nnumer = data$numRareNS.noS/data$numCommNS.noS\ndenom = data$numRareS.noS/data$numCommS.noS\ny=log(numer/denom)\ny.finite = y[!is.infinite(y)]\ny[y == \"Inf\"] <- max(y.finite) +1\ny[y == \"-Inf\"] <- -max(y.finite) -1\nyuplimit = max(y.finite) +1\nbarplot(y, names.arg=data$resNum,ylim=c(-yuplimit,yuplimit),\n        main=paste('ns.rare:ns.comm/s.rare:s.comm variants noS by ',domain,'motif pos'), \n        col='purple')\n\n#############################################################\n#### relative risk = nsrare:ns/srare:s\n### noS\nx11()\npar(cex.axis=1, cex.lab=2, cex.main=2)\nnumer1 = data$numRareNS.noS/data$num.NS.noS\ndenom1 = data$numRareS.noS/(data$totVar.noS-data$num.NS.noS)\nj=log(numer1/denom1)\nbarplot(j, names.arg=data$resNum,\n        main=paste('ns.rare:ns/s.rare:s variants noS by ',domain,'motif pos'), \n        col='pink')\n",
    "created" : 1432845299563.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "25|1|42|0|\n",
    "hash" : "1399284087",
    "id" : "1B4575",
    "lastKnownWriteTime" : 1432892266,
    "path" : "~/Shared/scripts-R_perl_shell_macros/R codes/motifVar_rareEnrich.tpr.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}