{
    "contents" : "setwd(\"C:/Users/Jieming/Documents/thesis/lynne_work/motifVar/tpr/blosum_sift_polyphen2_gerp\")\n\nlibrary(ggplot2)\nlibrary(matrixcalc)\n\nboxbubbleplot <- function(title,resNumCol,scoreCol,lastCol,data, cexAxisFontSize=2)\n{\n  title = title\n  resNum = data[,resNumCol]\n  blosum = data[,scoreCol]\n  m=max(blosum)\n  tt.blosum=table(resNum, blosum)\n  range01 = function(x){(x-min(x))/(max(x)-min(x))}\n  # #   x11()\n  #   par(mar=c(5,6,4,4),xpd=TRUE,mar=c(1, 4, 1, 1) + 1)\n  #   boxplot(blosum~resNum,xlab=\"position\",ylab=paste(title,sep=\" \"),cex.lab=2, cex.axis=cexAxisFontSize, las=2)\n  #   \n  #   ## convert table counts of SNVs at each position to dataframe\n  #   a.blosum=as.data.frame(table(resNum))[,2]\n  #   text(0,m+0.5,paste(a.blosum,collapse=\" \"),adj = c(0,0))\n  #   \n  #   ###### bubble plot\n  #   df = expand.grid(sort(unique(resNum)),sort(unique(blosum)))\n  #   aa = as.vector(table(resNum, blosum))\n  #   df$value = aa\n  #   \n  #   # x11()\n  #   area = pi * (df$value/150)^2\n  #   par(mar=c(5,6,4,4),xpd=TRUE)\n  #   area = (range01(df$value)/2)^2 * pi\n  #   symbols(df$Var1,df$Var2,circles=area, inches=F, bg=rgb(1,0,0,0.5), fg=\"black\", yaxt=\"n\", \n  #           xaxt=\"n\",add=T)\n  #   \n  #   # axis(1,at=seq(1,34), las=2)\n  #   # axis(2,at=seq(-4,9))\n  #   # text(0,3,paste(a.blosum,collapse=\" \"),adj = c(0,0))\n  \n  ## ordered\n#     x11()\n  par(xpd=TRUE,mar=c(3, 4, 1, 1) + 1)\n  boxplot(blosum~data[,lastcol],xlab=\"position\",ylab=paste(title,sep=\" \"),cex.lab=2, cex.axis=cexAxisFontSize, las=2)\n  a.blosumordered=as.data.frame(table(data[,lastcol]))[,2]\n  text(0,m+0.5,paste(a.blosumordered,collapse=\" \"),adj = c(0,0))\n  \n  #### bubble\n#   x11()\n  par(xpd=TRUE)\n  df.ordered = expand.grid(sort(unique(data[,lastcol])),sort(unique(blosum)))\n  aa.ordered = as.vector(table(data[,lastcol], blosum))\n  df.ordered$value = aa.ordered\n  area.ordered = (range01(df.ordered$value)/2)^2 * pi\n  symbols(df.ordered$Var1,df.ordered$Var2,circles=area.ordered, inches=F, bg=rgb(1,0,0,0.5), fg=\"black\", yaxt=\"n\", \n          xaxt=\"n\",xlab='position',ylab=paste(title, \"scores\",sep=\" \"),add=T)\n  # axis(1,at=seq(1,34),labels=as.vector(sort(unique(data[,lastcol]))), las=2)\n  # axis(2,at=seq(-4,9))\n  \n  #   return(blosum);\n}\n\n####################################################################\n\nfilename = 'final.merged.ExAC.ens73.TPR.34aa.vepoutput.coding.canonical.sorted.auto.blosum62-30-35-40-45-50.sift.gerp.bed'\ndata = read.table(filename, header=F, stringsAsFactors = F, comment.char=\"\", sep=\"\\t\")\norder = read.table('order_relentropy.txt', header=T, stringsAsFactors = F, comment.char=\"\", sep=\"\\t\")\nlastcol=ncol(data)+1\nresNumCol=45\n\n## we insert ordered info into lastCol so order info is lastCol\ndata[,lastcol] = factor(data[,resNumCol], levels=levels(data[,resNumCol])<-order$pos)\n\n\n####################################################################\n## Condel\n## conseq \"neutral\"     NA            \"deleterious\"\n## resNum, condel score \ntitle = 'Condel'\nscoreCol = 69\ntt.condel=table(data[,resNumCol], data[,scoreCol])\n\n## convert table counts of SNVs at each position to dataframe; nonmissing\ncondel.nonmissData=data[complete.cases(data[,scoreCol]),]\n\nx11()\nboxbubbleplot(title,resNumCol,scoreCol,lastCol,condel.nonmissData, cexAxisFontSize=2)\n\n####################################################################\n## polyphen\n## conseq \"benign\"            NA                  \"probably_damaging\" \"possibly_damaging\" \"unknown\"\n## resNum, polyphen score \ntitle = 'Polyphen'\nscoreCol = 72\ntt.polyphen=table(data[,resNumCol], data[,scoreCol])\n\n## convert table counts of SNVs at each position to dataframe; nonmissing\npolyphen.nonmissData=data[complete.cases(data[,scoreCol]),]\n\nx11()\nboxbubbleplot(title,resNumCol,scoreCol,lastCol,polyphen.nonmissData, cexAxisFontSize=2)\n\n####################################################################\n## sift\n## conseq \"tolerated\"   NA            \"deleterious\"\n## resNum, sift score \ntitle = 'SIFT'\nscoreCol = 75\ntt.sift=table(data[,resNumCol], 1-data[,scoreCol])\n\n## convert table counts of SNVs at each position to dataframe; nonmissing\nsift.nonmissData=data[complete.cases(data[,scoreCol]),]\nsift.nonmissData[,scoreCol] = 1-nonmissData[,scoreCol]\n\nx11()\nboxbubbleplot(title,resNumCol,scoreCol,lastCol,sift.nonmissData, cexAxisFontSize=2)\n\n####################################################################\n## gerp\n## resNum, gerp score \ntitle = 'GERP'\nscoreCol = 76\nsiftscorecol = 75\ntt.gerp=table(data[,resNumCol], data[,scoreCol])\n\ngerp.nonmissData=data[complete.cases(data[,scoreCol]),]\ngerp.NSData=data[complete.cases(data[,siftscorecol]),]\n\nx11()\nboxbubbleplot(title,resNumCol,scoreCol,lastCol,gerp.nonmissData, cexAxisFontSize=2)\n\nx11()\nboxbubbleplot(title,resNumCol,scoreCol,lastCol,gerp.NSData, cexAxisFontSize=2)\n\n######################################################################\n## correlation scatter plots\n# gerp vs blosum30\nx11()\npar(xpd=TRUE,cex.axis=1, cex.lab=1.5, cex.main=1.5)\nrange.x = range(gerp.NSData$V76)\nrange.y = range(gerp.NSData$V77)\nplot(gerp.NSData$V76,gerp.NSData$V77,main=paste(\"NSonly all pos\"),xlab='GERP',ylab='BLOSUM30', xlim=range.x, ylim=range.y)\n\nrareVar=gerp.NSData[(gerp.NSData$V20 <= 0.005),]\ncommVar=gerp.NSData[(gerp.NSData$V20 > 0.005),]\npar(new=T)\nplot(rareVar$V76,rareVar$V77,col='red',xaxt='n',yaxt='n',xlab='',ylab='',pch=3, xlim=range.x, ylim=range.y)\npar(new=T)\nplot(commVar$V76,commVar$V77,col='blue',xaxt='n',yaxt='n',xlab='',ylab='',pch=3, xlim=range.x, ylim=range.y)\n\n## by position\nresNum = 24\nNSData = gerp.NSData[gerp.NSData[,resNumCol]==resNum,]\nx11()\nplot(NSData$V76,NSData$V77,main=paste(\"NSonly at pos\",resNum),xlab='GERP',ylab='BLOSUM30')\n\n#-------------------------------\n# gerp vs condel\nx11()\nrange.x = range(gerp.NSData$V76)\nrange.y = range(!is.na(gerp.NSData$V69))\nplot(gerp.NSData$V76,gerp.NSData$V69,main=paste(\"NSonly all pos\"),xlab='GERP',ylab='Condel', xlim=range.x, ylim=range.y)\npar(new=T)\nplot(rareVar$V76,rareVar$V69,col='red',xaxt='n',yaxt='n',xlab='',ylab='',pch=3, xlim=range.x, ylim=range.y)\npar(new=T)\nplot(commVar$V76,commVar$V69,col='blue',xaxt='n',yaxt='n',xlab='',ylab='',pch=3, xlim=range.x, ylim=range.y)\n\n## by position\nresNum = 11\nNSData = gerp.NSData[gerp.NSData[,resNumCol]==resNum,]\nx11()\nplot(NSData$V76,NSData$V69,main=paste(\"NSonly at pos\",resNum),xlab='GERP',ylab='Condel', xlim=range.x, ylim=range.y)\n\n\n#-------------------------------\n# condel VS blosum30\nx11()\nplot(gerp.NSData$V69,gerp.NSData$V77,main=paste(\"NSonly all pos\"),xlab='Condel',ylab='BLOSUM30')\n\npar(new=T)\nplot(rareVar$V69,rareVar$V77,col='red',xaxt='n',yaxt='n',xlab='',ylab='')\npar(new=T)\nplot(commVar$V69,commVar$V77,col='blue',xaxt='n',yaxt='n',xlab='',ylab='')\n\n\n## by position\nresNum = 20\nNSData = gerp.NSData[gerp.NSData[,resNumCol]==resNum,]\nx11()\nplot(NSData$V76,NSData$V69,main=paste(\"NSonly at pos\",resNum),xlab='Condel',ylab='BLOSUM30')",
    "created" : 1432845269437.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "6|1|57|0|\n",
    "hash" : "455841732",
    "id" : "DAEA3B20",
    "lastKnownWriteTime" : 1432932373,
    "path" : "~/Shared/scripts-R_perl_shell_macros/R codes/motifVar_condel-sift-polyp.tpr.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}